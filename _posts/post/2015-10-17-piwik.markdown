---
layout: post
title:  "正在使用 Piwik 作为网站的统计"
date:   2015-10-17 13:05:00+08:00
image:
  title: unsplash.com/object.jpeg

tag: 
- Piwik

category: post
---

国内的统计服务不多，而且界面很差。国外的 Google Analytics 虽然很好使，但时常无法加载，而且统计中国用户的数据不全。

于是我发现了 [Piwik](https://piwik.org) 这个软件。此软件基于 PHP 开发，利用 MySQL 数据库存储统计。

放弃 Google Analytics 而使用自己搭建 Piwik 做统计，就相当于放弃 Blogger 而使用自己搭建的 WordPress，数据全部存放在自己的服务器上，同时也能通过通用的 API 来进行调用。就像 WordPress 有自己的手机客户端、能安装插件一样，Piwik 也一样都有。

## 使用 OpenShift Online 部署 Piwik

如果你使用 OpenShift Online，那么就能一键部署 Piwik。首先进入 [Create a New Application - Piwik Quickstart](https://openshift.redhat.com/app/console/application_type/quickstart!3) 的页面，然后创建即可（尚未测试能否开启 Scaling，有可能不支持）。然后访问你创建的 Application，按照步骤来创建即可，其中数据库地址会自动填写。

## 使用 AWS Elastic Beanstalk 部署 Piwik

当然你也可以使用 AWS Elastic Beanstalk 来部署 Piwik，如果直接将 Piwik 包上传至 S3 并部署，会报错而导致无法安装。需要修改 php.ini 的参数，Elastic Beanstalk 似乎并不能直接修改，所以需要在根目录下创建 `.ebextensions` 文件夹，并在此文件夹中放入一个以 `.config` 结尾的文件（文件名随意）。

{% include img-small.html img="//cdn-tlo.b0.upaiyun.com/ze3kr/2015/2015-10-17-17.37.03.png" %}

我就创建了一个 `php-ini.config` 文件，可以用 YAML 或者 JSON 标记语言写，内容如下：

{% highlight yaml %}
files:
  "/etc/php.d/project.ini" :
    mode: "000644"
    owner: root
    group: root
    content: |
      always_populate_raw_post_data=-1
{% endhighlight %}

然后，Piwik 就能正确的安装了，注意选择配置好环境。
